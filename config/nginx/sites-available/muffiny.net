
server {
        listen   80;
        server_name stable.tagasauris.com;

        access_log  /var/log/stable-tagasauris/nginx-access.log;
        error_log   /var/log/stable-tagasauris/nginx-error.log;

        listen               443;
        ssl                  on;
        ssl_certificate      /etc/nginx/ssl/cert.pem;
        ssl_certificate_key  /etc/nginx/ssl/cert.key;
        keepalive_timeout    70;
         
        rewrite ^/_docs/(.*) /build/$1 last;
        location /build {                                
                rewrite ^/_docs/(.*)$ /$1 last;
                gzip on;        
                index  index.html; 
                root /home/stable/tagasauris/src/doc/;
                autoindex off;
                expires 60d; 
                
        }  
            
		rewrite ^/statics/admin/(.*)$ /admin/media/$1;

        location /statics  {
                gzip on;
                root /home/stable/tagasauris/src/tagasauris/;
                autoindex off;
                expires 60d;
        }

        location /admin/media {
                gzip on;
                root /home/stable/tagasauris/src/django/django/contrib/;
                autoindex off;
                expires 60d;
        }
            
            
        location / {

                expires -1;

                proxy_read_timeout 300;
                proxy_connect_timeout 300;
                auth_basic off;

                # host and port to fastcgi server
                fastcgi_pass 127.0.0.1:8001;
                fastcgi_param PATH_INFO $fastcgi_script_name;
                fastcgi_param REQUEST_METHOD $request_method;
                fastcgi_param QUERY_STRING $query_string;
                fastcgi_param CONTENT_TYPE $content_type;
                fastcgi_param CONTENT_LENGTH $content_length;
                fastcgi_param SERVER_PROTOCOL $server_protocol;
                fastcgi_param SERVER_PORT $server_port;
                fastcgi_param SERVER_NAME $server_name;
				fastcgi_param    REMOTE_ADDR  $remote_addr;
				fastcgi_param    REMOTE_PORT  $remote_port;
                fastcgi_pass_header Authorization;
                fastcgi_intercept_errors off;
        }
        

        error_page   404  /404.html;
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
                root   /var/www/nginx-default;
        }



}
